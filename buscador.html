<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador - ESI</title>
    <link rel="stylesheet" href="estilo.css">
    <style>
        #categoria-info { display: flex !important; }
        #menu { display: flex !important; }
        
        #search-container { 
            display: flex !important; 
            flex-direction: column !important; 
            align-items: center !important; 
            padding: 20px !important; 
            width: 100% !important;
            padding-bottom: 100px !important;
        }
        #search-container h2 { 
            color: #a267f5; 
            margin-bottom: 20px; 
            font-size: 24px;
        }
        #search-bar {
            width: 300px !important;
            padding: 12px !important;
            font-size: 16px !important;
            border: 1px solid #ccc !important;
            border-radius: 5px !important;
            margin-bottom: 10px !important;
        }
        #search-button {
            padding: 10px 30px !important;
            background: #a267f5 !important;
            color: white !important;
            border: none !important;
            border-radius: 5px !important;
            cursor: pointer !important;
            font-size: 16px !important;
        }
        #search-suggestions {
            margin: 20px 0 !important;
            display: flex !important;
            gap: 10px !important;
            flex-wrap: wrap !important;
            justify-content: center !important;
        }
        .search-suggestion {
            background: #ede9feff !important;
            color: #a267f5 !important;
            padding: 8px 15px !important;
            border: 1px solid #a267f5 !important;
            border-radius: 20px !important;
            cursor: pointer !important;
            font-size: 14px !important;
        }
        .search-suggestion:hover {
            background: #a267f5 !important;
            color: white !important;
        }
        #search-results {
            display: none !important;
            width: 90% !important;
            max-width: 600px !important;
            margin-top: 20px !important;
        }
        #search-results table {
            width: 100% !important;
            border-collapse: collapse !important;
            background: white !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
        }
        #search-results th {
            background: #a267f5 !important;
            color: white !important;
            padding: 12px !important;
            text-align: left !important;
        }
        #search-results td {
            border: 1px solid #ddd !important;
            padding: 12px !important;
        }
        .result-row {
            cursor: pointer !important;
        }
        .result-row:hover {
            background: #f5f5f5 !important;
        }
        .additional-info {
            background: #ede9feff !important;
        }
    </style>
</head>
<body>
    <!-- BARRA DE INFORMACI√ìN -->
    <div id="categoria-info">
        <img id="categoria-imagen" src="logocresi.png" alt="Logo">
        <h2 id="categoria-nombre">üîç Buscador</h2>
        <div id="contador">
            <img src="corazon2.svg" alt="corazon" class="icocontador">
            <div id="vidas">3</div>
        </div>
        <div id="contador">
            <img src="icodiamante.svg" alt="diamante" class="icocontador">
            <div id="correctas">0</div>
        </div>
    </div>

    <!-- BUSCADOR -->
    <div id="search-container">
        <h2>Buscar Preguntas</h2>
        <input type="text" id="search-bar" placeholder="Escribe una palabra...">
        <button id="search-button">üîç Buscar</button>
        <div id="search-suggestions">
            <button class="search-suggestion">Sexualidad</button>
            <button class="search-suggestion">ITS</button>
            <button class="search-suggestion">Preservativo</button>
            <button class="search-suggestion">Consentimiento</button>
            <button class="search-suggestion">Menstruaci√≥n</button>
        </div>
        <div id="search-results">
            <table id="results-table">
                <thead>
                    <tr><th>Pregunta</th></tr>
                </thead>
                <tbody id="results-body"></tbody>
            </table>
        </div>
    </div>

    <!-- MEN√ö FLOTANTE -->
    <div id="menu">
        <div class="floating-button" id="playButton2">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M7 4v16l13 -8z" />
            </svg>
        </div>
        <div id="volado">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                <path fill="#a267f5ff" fill-opacity="1" d="M0,160L48,133.3C96,107,192,53,288,64C384,75,480,149,576,197.3C672,245,768,267,864,272C960,277,1056,267,1152,250.7C1248,235,1344,213,1392,202.7L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
            </svg>
        </div>
        <div class="menu-button" id="home-icon"><img src="home.svg" alt="home"></div>
        <div class="menu-button" id="search-icon"><img src="buscar.svg" alt="buscar"></div>
        <div class="menu-button" id="contact-icon"><img src="correo.svg" alt="correo"></div>
        <div class="menu-button" id="corazon-icon"><img src="corazon.svg" alt="amor"></div>
        <div class="menu-button" id="infografia-icon"><img src="infografia.svg" alt="infografia"></div>
        <div class="menu-button" id="trivia-icon"><img src="jugartrivia.svg" alt="trivia"></div>
    </div>

    <!-- SCRIPTS -->
    <script src="shared-config.js"></script>
    <script src="preguntas.js"></script>
    <script>
        const resultsPerPage = 4;
        let currentPage = 0;
        let allResults = [];

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeBuscador);
        } else {
            initializeBuscador();
        }

        function initializeBuscador() {
            updateCounters();
            setupEventListeners();
        }

        function setupEventListeners() {
            document.getElementById('home-icon').addEventListener('click', goHome);
            document.getElementById('search-button').addEventListener('click', performSearch);
            document.getElementById('search-bar').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') performSearch();
            });

            const suggestions = document.querySelectorAll('.search-suggestion');
            suggestions.forEach(btn => {
                btn.addEventListener('click', function() {
                    document.getElementById('search-bar').value = this.textContent;
                    performSearch();
                });
            });
        }

        function updateCounters() {
            document.getElementById('vidas').textContent = vidas;
            document.getElementById('correctas').textContent = correctas;
        }

        function performSearch() {
            const searchTerm = document.getElementById('search-bar').value;
            buscarPreguntas(searchTerm);
        }

        function buscarPreguntas(term) {
            currentPage = 0;
            const searchTerm = term.toLowerCase().trim();
            const resultsBody = document.getElementById('results-body');
            resultsBody.innerHTML = '';

            if (searchTerm.length === 0) {
                document.getElementById('search-results').style.display = 'none';
                return;
            }

            allResults = preguntas.filter(p => 
                (p.pregunta && p.pregunta.toLowerCase().includes(searchTerm)) ||
                (p.respuestacorrecta && p.respuestacorrecta.toLowerCase().includes(searchTerm)) ||
                (p.masInfo && p.masInfo.toLowerCase().includes(searchTerm))
            );

            if (allResults.length > 0) {
                renderResults(allResults);
                document.getElementById('search-results').style.display = 'block';
            } else {
                const row = document.createElement('tr');
                row.innerHTML = `<td style="text-align: center; padding: 20px;">No se encontraron resultados para "${term}"</td>`;
                resultsBody.appendChild(row);
                document.getElementById('search-results').style.display = 'block';
            }
        }

        function renderResults(results) {
            const resultsBody = document.getElementById('results-body');
            resultsBody.innerHTML = '';
            const start = currentPage * resultsPerPage;
            const end = start + resultsPerPage;
            const paginatedResults = results.slice(start, end);

            paginatedResults.forEach((result) => {
                const row = document.createElement('tr');
                row.className = 'result-row';
                row.innerHTML = `<td>${result.pregunta || 'N/A'}</td>`;
                row.onclick = function() {
                    const nextRow = this.nextElementSibling;
                    if (nextRow && nextRow.querySelector('.additional-info')) {
                        const infoCell = nextRow.querySelector('.additional-info');
                        infoCell.style.display = infoCell.style.display === 'none' ? 'block' : 'none';
                    }
                };
                resultsBody.appendChild(row);

                const infoRow = document.createElement('tr');
                const infoCell = document.createElement('td');
                infoCell.colSpan = 1;
                infoCell.className = 'additional-info';
                infoCell.innerHTML = `<strong>M√°s Informaci√≥n:</strong><br>${result.masInfo || 'N/A'}`;
                infoCell.style.display = 'none';
                infoRow.appendChild(infoCell);
                resultsBody.appendChild(infoRow);
            });
        }

        function goHome() {
            saveGameData();
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>