<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trivia - ESI</title>
    <link rel="stylesheet" href="estilo.css">
    <style>
        #categoria-info { display: flex !important; }
        #pantallatrivia { display: flex !important; flex-direction: column !important; align-items: center !important; }
        #trivia-content { display: flex !important; flex-direction: column !important; align-items: center !important; }
        #pregunta-containerTrivia { display: none !important; }
        #respuesta-containerTrivia { display: none !important; }
        #felicitaciones { display: none !important; }
        #menu { display: flex !important; }
        #trivia-card-container { 
            display: grid !important; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)) !important; 
            gap: 20px !important;
            width: 90% !important;
            margin: 20px auto !important;
        }
        .trivia-card {
            background: #ede9feff !important;
            border: 1px solid #a267f5 !important;
            border-radius: 10px !important;
            padding: 20px !important;
            text-align: center !important;
            cursor: pointer !important;
        }
        .trivia-card button {
            background: #a267f5 !important;
            color: white !important;
            padding: 10px 20px !important;
            border: none !important;
            border-radius: 5px !important;
            cursor: pointer !important;
        }
        .respuesta {
            background: #3498db !important;
            color: white !important;
            padding: 15px !important;
            margin: 10px !important;
            border-radius: 5px !important;
            cursor: pointer !important;
            border: none !important;
            width: 90% !important;
        }
    </style>
</head>
<body>
    <!-- BARRA DE INFORMACIÓN -->
    <div id="categoria-info">
        <img id="categoria-imagen" src="logocresi.png" alt="Logo">
        <h2 id="categoria-nombre">Trivia</h2>
        <div id="contador">
            <img src="corazon2.svg" alt="corazon" class="icocontador">
            <div id="vidas">3</div>
        </div>
        <div id="contador">
            <img src="icodiamante.svg" alt="diamante" class="icocontador">
            <div id="correctas">0</div>
        </div>
    </div>

    <!-- PANTALLA DE TRIVIA -->
    <div id="pantallatrivia">
        <div id="trivia-content">
            <h2>Jugar por Trivia</h2>
            <div id="trivia-pagination" style="margin: 20px 0;"></div>
            <div id="trivia-card-container"></div>
        </div>

        <div id="pregunta-containerTrivia" style="flex-direction: column; align-items: center; padding: 20px;">
            <h2 id="preguntaTrivia"></h2>
            <div id="respuestasTrivia"></div>
        </div>

        <div id="respuesta-containerTrivia" style="background: #a267f5ab; padding: 20px; border-radius: 10px; margin: 20px; flex-direction: column; align-items: center;">
            <img src="CorrectoNew.png" alt="" id="correctoincorrectoTrivia" style="max-width: 100px; opacity: 0;">
            <p id="preguntaCorrectaTrivia"></p>
            <p id="resCorrectaTrivia">Respuesta Correcta</p>
            <button id="repor" style="background: #666; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 10px;">Reportar Pregunta</button>
            <div id="mainfoTrivia" style="background: white; padding: 10px; border-radius: 5px; margin: 10px; max-width: 400px;">Más Información</div>
            <button id="continuartrivia" style="background: #a267f5; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">Continuar</button>
        </div>

        <div id="felicitaciones" style="flex-direction: column; align-items: center; padding: 20px; text-align: center;">
            <img src="felicitaciones.png" alt="felicitaciones" style="max-width: 150px; margin: 20px 0;">
            <h3 id="titulofelicitaciones"></h3>
            <button id="botonVolver" style="background: #a267f5; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px;">Seguir Jugando</button>
        </div>
    </div>

    <!-- MENÚ FLOTANTE -->
    <div id="menu">
        <div class="floating-button" id="playButton2">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
              <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
              <path d="M7 4v16l13 -8z" />
            </svg>
        </div>
        <div id="volado">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320">
                <path fill="#a267f5ff" fill-opacity="1" d="M0,160L48,133.3C96,107,192,53,288,64C384,75,480,149,576,197.3C672,245,768,267,864,272C960,277,1056,267,1152,250.7C1248,235,1344,213,1392,202.7L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
            </svg>
        </div>
        <div class="menu-button" id="home-icon"><img src="home.svg" alt="home"></div>
        <div class="menu-button" id="search-icon"><img src="buscar.svg" alt="buscar"></div>
        <div class="menu-button" id="contact-icon"><img src="correo.svg" alt="correo"></div>
        <div class="menu-button" id="corazon-icon"><img src="corazon.svg" alt="amor"></div>
        <div class="menu-button" id="infografia-icon"><img src="infografia.svg" alt="infografia"></div>
        <div class="menu-button" id="trivia-icon"><img src="jugartrivia.svg" alt="trivia"></div>
    </div>

    <!-- SCRIPTS -->
    <script src="shared-config.js"></script>
    <script src="preguntas.js"></script>
    <script>
        const cardsPerPage = 4;
        let currentPageTrivia = 0;
        let selectedTriviaQuestions = [];
        let currentQuestionIndexTrivia = 0;

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeTrivia);
        } else {
            initializeTrivia();
        }

        function initializeTrivia() {
            updateCounters();
            displayCards(1);
            setupEventListeners();
        }

        function setupEventListeners() {
            document.getElementById('home-icon').addEventListener('click', goHome);
            document.getElementById('search-icon').addEventListener('click', () => navigateTo('buscador.html'));
            document.getElementById('contact-icon').addEventListener('click', () => navigateTo('contacto.html'));
            document.getElementById('corazon-icon').addEventListener('click', () => navigateTo('amor.html'));
            document.getElementById('infografia-icon').addEventListener('click', () => navigateTo('infografia.html'));
            document.getElementById('continuartrivia').addEventListener('click', continuarTrivia);
            document.getElementById('botonVolver').addEventListener('click', volverATrivia);
            document.getElementById('repor').addEventListener('click', reportarPregunta);
        }

        function updateCounters() {
            document.getElementById('vidas').textContent = vidas;
            document.getElementById('correctas').textContent = correctas;
        }

        function displayCards(page) {
            const triviaContainer = document.getElementById('trivia-card-container');
            triviaContainer.innerHTML = '';
            const startIndex = (page - 1) * cardsPerPage;
            const endIndex = startIndex + cardsPerPage;
            const cardsToShow = triviaData.slice(startIndex, endIndex);

            cardsToShow.forEach(trivia => {
                const card = document.createElement('div');
                card.className = 'trivia-card';
                card.innerHTML = `
                    <h3>${trivia.name}</h3>
                    <p>${trivia.percentage}</p>
                    <button>Jugar</button>
                `;
                card.querySelector('button').addEventListener('click', function() {
                    seleccionarTrivia(trivia.name);
                });
                triviaContainer.appendChild(card);
            });

            updatePagination(page);
        }

        function updatePagination(currentPage) {
            const paginationContainer = document.getElementById('trivia-pagination');
            paginationContainer.innerHTML = '';
            const totalPages = Math.ceil(triviaData.length / cardsPerPage);

            for (let i = 1; i <= totalPages; i++) {
                const span = document.createElement('span');
                span.textContent = i;
                span.style.cssText = 'margin: 0 10px; cursor: pointer; padding: 5px 10px; border-radius: 5px;';
                if (i === currentPage) {
                    span.style.background = '#a267f5';
                    span.style.color = 'white';
                }
                span.addEventListener('click', () => {
                    currentPageTrivia = i - 1;
                    displayCards(i);
                });
                paginationContainer.appendChild(span);
            }
        }

        function seleccionarTrivia(nombreTrivia) {
            document.getElementById('categoria-nombre').textContent = nombreTrivia;
            selectedTriviaQuestions = preguntas.filter(pregunta => pregunta.trivia === nombreTrivia);
            currentQuestionIndexTrivia = 0;

            if (selectedTriviaQuestions.length > 0) {
                document.getElementById('trivia-content').style.display = 'none';
                mostrarPreguntaTrivia();
            } else {
                alert('No hay preguntas disponibles para esta trivia');
            }
        }

        function mostrarPreguntaTrivia() {
            document.getElementById('pregunta-containerTrivia').style.display = 'flex';

            if (currentQuestionIndexTrivia < selectedTriviaQuestions.length) {
                const currentQuestion = selectedTriviaQuestions[currentQuestionIndexTrivia];
                document.getElementById('preguntaTrivia').textContent = currentQuestion.pregunta;
                document.getElementById('preguntaCorrectaTrivia').textContent = currentQuestion.pregunta;
                document.getElementById('resCorrectaTrivia').textContent = currentQuestion.respuestacorrecta;

                const respuestasContainer = document.getElementById('respuestasTrivia');
                respuestasContainer.innerHTML = '';
                const respuestas = [
                    currentQuestion.respuestacorrecta,
                    currentQuestion.respuesta1,
                    currentQuestion.respuesta2,
                    currentQuestion.respuesta3
                ];
                shuffleArray(respuestas);

                respuestas.forEach((respuesta) => {
                    const button = document.createElement('button');
                    button.className = 'respuesta';
                    button.textContent = respuesta;
                    button.addEventListener('click', () => verificarRespuestaTrivia(respuesta));
                    respuestasContainer.appendChild(button);
                });
            } else {
                mostrarFelicitacionesTrivia();
            }
        }

        function verificarRespuestaTrivia(respuestaSeleccionada) {
            const currentQuestion = selectedTriviaQuestions[currentQuestionIndexTrivia];
            
            if (respuestaSeleccionada === currentQuestion.respuestacorrecta) {
                document.getElementById('correctoincorrectoTrivia').src = 'CorrectoNew.png';
                correctas++;
            } else {
                document.getElementById('correctoincorrectoTrivia').src = 'IncorrectoNew.png';
                document.getElementById('resCorrectaTrivia').textContent = currentQuestion.respuestacorrecta;
                vidas--;
            }

            document.getElementById('pregunta-containerTrivia').style.display = 'none';
            document.getElementById('respuesta-containerTrivia').style.display = 'flex';
            document.getElementById('correctoincorrectoTrivia').style.opacity = '1';
            updateCounters();
        }

        function continuarTrivia() {
            currentQuestionIndexTrivia++;
            document.getElementById('respuesta-containerTrivia').style.display = 'none';
            mostrarPreguntaTrivia();
        }

        function mostrarFelicitacionesTrivia() {
            document.getElementById('pregunta-containerTrivia').style.display = 'none';
            document.getElementById('respuesta-containerTrivia').style.display = 'none';
            document.getElementById('felicitaciones').style.display = 'flex';
            document.getElementById('titulofelicitaciones').innerHTML = `
                ¡Felicitaciones, completaste la trivia!<br>
                Lograste ${correctas} preguntas correctas
            `;
        }

        function volverATrivia() {
            document.getElementById('felicitaciones').style.display = 'none';
            document.getElementById('trivia-content').style.display = 'flex';
            currentQuestionIndexTrivia = 0;
            displayCards(1);
        }

        function reportarPregunta() {
            saveGameData();
            window.location.href = 'contacto.html?pregunta=' + encodeURIComponent(selectedTriviaQuestions[currentQuestionIndexTrivia].pregunta);
        }

        function goHome() {
            saveGameData();
            window.location.href = 'index.html';
        }

        function navigateTo(page) {
            saveGameData();
            window.location.href = page;
        }
    </script>
</body>
</html>